@using leavedays.Models.ViewModels.License;
@using leavedays.Models;
@model LicenseInformation
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="tulox"></div>
<div class="bordered">
    <h2>Add Modules</h2>
    <br />
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <table>
        <tr>
            <td>Name</td>
            <td>@Model.LicenseName</td>

        </tr>
        <tr>
            <td>License Code</td>
            <td>@Model.LicenseCode</td>
        </tr>
        <tr>
            <td>Available for purchase modules</td>
            <td>
                @using (Ajax.BeginForm(new AjaxOptions
                {
                    Url = "/module/remove",
                    UpdateTargetId = "tulox"
                }))
                {
                    <table id="moduleTable">

                        @if (Model.DefaultModules.Count == 0)
                        {
                            <text>No available for purchase modules</text>
                        }
                        else
                        {
                            for (int i = 0; i < Model.DefaultModules.Count; i++)
                            {
                                @Html.Hidden("model.Index", i)
                                <tr price="@Model.DefaultModules[i].Price">

                                    <td>
                                        @Html.CheckBox("model[" + i + "].Checked")
                                        @Html.Hidden("model[" + i + "].ModuleId", Model.DefaultModules[i].Id)
                                    </td>
                                    <td>@Model.DefaultModules[i].Name</td>
                                    <td>@Model.DefaultModules[i].Price per person per month.</td>
                                </tr>
                            }
                        }
                    </table>
                    <input type="submit" name="submit" value="tulox" />
                }

            </td>
        </tr>
    </table>
    <div id="info" style="display: none; margin: 25px 0 0  20%;">
        <span>
            Extra costs: $<span id="price">0</span> per user per month.
        </span>
        <br />
        <span>
            You have <span id="total">@Model.LicensesCount</span> licenses of which <span id="active">@Model.ActiveLicensesCount</span> active.
        </span>
        <br />
        <span>
            This will result in <span id="tatalCosts">0</span> extra per month.
        </span>
        <br />
        <span>
            Please confirm by clicking "Save" below.
        </span>
    </div>
</div>
<div style="margin-left: 10px;">
    <input type="button" value="Submit" id="submit" />
</div>

@*<script>
        $(document).ready(function () {

            var active = parseInt($('#active').html(), 10);
            var totalCostsFiled = $('#tatalCosts');

            var price = $('#price');
            var table = $('#moduleTable');
            var submit = $('#submit');
            var infoBlock = $('#info');
            var checked;

            $(table).on('click', 'input[type="checkbox"]', function () {
                var extraCostsNum = 0.0;
                checked = $(table).find('td').find('input[type="checkbox"]:checked:not(.invisible)');
                $(checked).each(function (index, data) {
                    var tr = $(this).parent().parent();
                    extraCostsNum = parseFloat($(tr).attr('price')) + extraCostsNum;
                    console.log(parseFloat($(tr).attr('price')));
                });

                if (extraCostsNum > 0.0) {
                    $(price).html(extraCostsNum);
                    $(totalCostsFiled).html('$' + (extraCostsNum * active));
                    $(infoBlock).show();
                }
                else {
                    $(infoBlock).fadeOut(200);
                }
            });

            $(submit).on('click', function () {
                var line = '';
                $(checked).each(function (index, data) {
                    line += $(this).attr('name') + ',';
                    var tr = $(this).parent().parent();
                    $(this).toggleClass('invisible', true);
                    $(infoBlock).hide();
                    $(tr).fadeOut(500);
                });

                $.ajax({
                    url: location.origin + '/Admin/EnableModules',
                    type: "POST",
                    data: {
                        modulesLine: line
                    }
                });
            });
        });
    </script>*@
